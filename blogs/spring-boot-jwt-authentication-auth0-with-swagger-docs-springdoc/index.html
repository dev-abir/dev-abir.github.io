<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Spring boot JWT authentication (auth0) with Swagger docs (springdoc) | Abir Ganguly | Portfolio</title>
<meta name=keywords content="springboot,springsecurity,webdev,java"><meta name=description content="Why?   This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:   To understand..."><meta name=author content><link rel=canonical href=https://dev.to/abir777/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc-1bp0><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://dev-abir.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dev-abir.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dev-abir.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://dev-abir.github.io/apple-touch-icon.png><link rel=mask-icon href=https://dev-abir.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dev-abir.github.io/blogs/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Spring boot JWT authentication (auth0) with Swagger docs (springdoc)"><meta property="og:description" content="Why?   This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:   To understand..."><meta property="og:type" content="article"><meta property="og:url" content="https://dev-abir.github.io/blogs/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc/"><meta property="og:image" content="https://dev-abir.github.io/cropped.jpeg"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-05-29T17:15:44+00:00"><meta property="article:modified_time" content="2024-05-29T17:15:44+00:00"><meta property="og:site_name" content="Abir Ganguly | Portfolio"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dev-abir.github.io/cropped.jpeg"><meta name=twitter:title content="Spring boot JWT authentication (auth0) with Swagger docs (springdoc)"><meta name=twitter:description content="Why?   This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:   To understand..."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://dev-abir.github.io/blogs/"},{"@type":"ListItem","position":2,"name":"Spring boot JWT authentication (auth0) with Swagger docs (springdoc)","item":"https://dev-abir.github.io/blogs/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring boot JWT authentication (auth0) with Swagger docs (springdoc)","name":"Spring boot JWT authentication (auth0) with Swagger docs (springdoc)","description":"Why?   This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:   To understand...","keywords":["springboot","springsecurity","webdev","java"],"articleBody":"üîó dev.to link Why? This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:\nTo understand and document my understanding about spring security. The existing articles mostly use jjwt which has a vulnerable release (as of now). Thus, I decided to use an alternative library, along with springdoc openapi 3 swagger docs. Probably you could scavenge the internet, and use LLMs to put up such an implementation. I just created a cookbook kind of, you may use it as a guide.\nLet‚Äôs start‚Ä¶\nHow? This is not at all a beginner‚Äôs guide, and I would assume the reader knows the basics of spring, IOC container, gradle, spring data JPA, how to build basic CRUD in spring boot.\nAs a starting point, you may follow this guide .\nInitialize This is a simple CRUD application with just 3 routes: /register, /login and /profile (protected route). I hope this is pretty much self-explanatory. We will be using the H2 database , which is an in-memory database. It is easy to deal with during development, but not ideal for production. There‚Äôs also an inbuilt web UI for H2 database.\nGo to Spring boot initializr .\nYou will need the following dependencies:\ndependencies { implementation 'org.springframework.boot:spring-boot-starter-data-jpa' implementation 'org.springframework.boot:spring-boot-starter-security' implementation 'org.springframework.boot:spring-boot-starter-validation' implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'com.auth0:java-jwt:4.4.0' implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.5.0' compileOnly 'org.projectlombok:lombok' runtimeOnly 'com.h2database:h2' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.security:spring-security-test' testRuntimeOnly 'org.junit.platform:junit-platform-launcher' } The above alien language is groovy, which is used to configure Gradle build system (similar to xml in maven). The dependencies block is straightforward and pretty self-explanatory (one of the reasons why I prefer Gradle).\nNow, extract and import the gradle/maven project into your preferred editor. If any error occurs, make sure about spring and Java version.\nTwo dependencies (com.auth0:java-jwt and org.springdoc:springdoc-openapi-starter-webmvc-ui) aren‚Äôt available in spring starter. Get them from here and here .\nModel We will first create our model, then controller, then service, in the meantime, we will also learn about the required things as we go along‚Ä¶\nCreate a package called controller.\nCreate UserDao.java:\npackage org.devabir.jwtexample.model; import jakarta.persistence.Column; import jakarta.persistence.Entity; import jakarta.persistence.Id; import jakarta.persistence.Table; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import org.hibernate.annotations.CreationTimestamp; import org.hibernate.annotations.UpdateTimestamp; import java.util.Date; @Entity @Table(name = \"user_\") @Data @AllArgsConstructor @NoArgsConstructor public class UserDao { @Id private String email; @Column(nullable = false, name = \"hashed_password\") private String hashedPassword; @CreationTimestamp @Column(name = \"created_at\", updatable = false, nullable = false) private final Date createdAt = new Date(); @UpdateTimestamp @Column(name = \"updated_at\") private Date updatedAt; } This is for interacting with the database. Most db has user as reserved keyword, hence, we are calling it user_.\nGetters, setters, and constructors are all auto-generated by the annotations from lombok. If you are new to this, you should spend some time and setup lombok in your ide .\nCreate UserRequestDto.java:\npackage org.devabir.jwtexample.model; import jakarta.validation.constraints.Email; import jakarta.validation.constraints.NotBlank; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class UserRequestDto { @NotBlank(message = \"Email is mandatory.\") // This email regex works. Trust me :) @Email(message = \"Please enter a valid email.\", regexp = \"^[a-zA-Z0-9_!#$%\u0026‚Äô*+/=?`{|}~^.-]+@[a-zA-Z0-9.-]+$\") private String email; @NotBlank(message = \"Password is mandatory.\") private String password; } It also has validation logic. The email regex is sourced from some online searches, and it will work every time (trust me :)).\nCreate UserResponseDto.java:\npackage org.devabir.jwtexample.model; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.util.Date; @Data @AllArgsConstructor @NoArgsConstructor public class UserResponseDto { private String email; private Date createdAt; private Date updatedAt; } Separate Response object, so that we don‚Äôt accidentally leak out confidential attributes like password, also it includes generated fields like created and updated timestamp.\nCreate TokenResponse.java:\npackage org.devabir.jwtexample.model; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class TokenResponse { private String accessToken; private UserResponseDto user; } This class will be specifically used to respond on a /login request. We will not only send the user info, but also the JWT access token. In later sections, we will see how to set up the JWT part.\nThis is all about the models, now let‚Äôs set up the repository for interacting with the database.\nJPA Repository Create a package called repository, then inside that create UserRepository.java:\npackage org.devabir.jwtexample.repository; import org.devabir.jwtexample.model.UserDao; import org.springframework.data.jpa.repository.JpaRepository; public interface UserRepository extends JpaRepository\u003cUserDao, String\u003e { } Controller We have only one controller. Create a package controller, inside that a file AuthController.java:\npackage org.devabir.jwtexample.controller; import io.swagger.v3.oas.annotations.Operation; import io.swagger.v3.oas.annotations.security.SecurityRequirement; import jakarta.validation.Valid; import org.devabir.jwtexample.model.TokenResponse; import org.devabir.jwtexample.model.UserRequestDto; import org.devabir.jwtexample.model.UserResponseDto; import org.devabir.jwtexample.service.AuthService; import org.devabir.jwtexample.service.JwtService; import org.springframework.http.HttpStatus; import org.springframework.http.ResponseEntity; import org.springframework.security.core.Authentication; import org.springframework.security.core.context.SecurityContextHolder; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.web.bind.annotation.*; @RestController @RequestMapping(\"/auth\") public class AuthController { private final AuthService authService; private final JwtService jwtService; public AuthController(AuthService authService, JwtService jwtService) { this.authService = authService; this.jwtService = jwtService; } @PostMapping(\"/register\") public ResponseEntity\u003cUserResponseDto\u003e register(@Valid @RequestBody UserRequestDto userRequestDto) { return ResponseEntity .status(HttpStatus.CREATED) .body(this.authService.register(userRequestDto)); } @PostMapping(\"/login\") public ResponseEntity\u003cTokenResponse\u003e login(@Valid @RequestBody UserRequestDto userRequestDto) { UserResponseDto user = authService.login(userRequestDto); final String accessToken = jwtService.buildToken(user.getEmail()); return ResponseEntity.ok(new TokenResponse(accessToken, user)); } @Operation(security = {@SecurityRequirement(name = \"bearer-key\")}) @GetMapping(\"/profile\") public ResponseEntity\u003cUserResponseDto\u003e profile() { Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); UserDetails userDetails = (UserDetails) authentication.getPrincipal(); final String email = userDetails.getUsername(); return ResponseEntity.ok(this.authService.profile(email)); } } This controller has 2 dependencies, AuthService and JwtService. We will eventually implement them. This controller will give us a high-level overview of the API we are going to create. @Valid annotation will validate the Bean with the constraints like @NotBlank, defined earlier, and throw an appropriate error. Spring‚Äôs default exception handler ProblemDetailsExceptionHandler , will respond with an appropriate JSON. @Operation(security = {@SecurityRequirement(name = \"bearer-key\")}) annotation is specific to springdoc, we will come to it at last. Just remember that it helps us to identify which routes require authentication in the generated docs. In English, this roughly translates to: ‚ÄúIf the user is authenticated, Spring should already have the authenticated user‚Äôs data, which we are simply accessing.‚Äù: Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); UserDetails userDetails = (UserDetails) authentication.getPrincipal(); final String email = userDetails.getUsername(); Keep this part in mind, we will again use these when setting up security configs. Service Create a package called service.\nCreate UserService.java:\npackage org.devabir.jwtexample.service; import org.devabir.jwtexample.model.UserDao; import org.devabir.jwtexample.model.UserResponseDto; import org.springframework.beans.BeanUtils; import org.springframework.stereotype.Service; @Service public class UserService { public UserResponseDto toDto(UserDao userDao) { UserResponseDto result = new UserResponseDto(); BeanUtils.copyProperties(userDao, result, \"hashedPassword\"); return result; } } This file only converts the DAO to DTO, thus adhering to separation-of-concerns. DTO and DAO have many common fields, thus we are copying the Bean properties. There are other methods like model-mapper, builder or constructor from lombok. This seemed short and simple enough. public static void copyProperties( Object source, Object target, String... ignoreProperties) throws BeansException {} This will work, even if you just omit the last parameter, I just included that to be explicit. Create JwtService.java:\npackage org.devabir.jwtexample.service; import com.auth0.jwt.JWT; import com.auth0.jwt.algorithms.Algorithm; import com.auth0.jwt.exceptions.JWTVerificationException; import com.auth0.jwt.interfaces.DecodedJWT; import com.auth0.jwt.interfaces.JWTVerifier; import org.springframework.beans.factory.annotation.Value; import org.springframework.stereotype.Service; import java.util.Date; @Service public class JwtService { private final long jwtExpiration; private final Algorithm signingAlgorithm; public JwtService( @Value(\"${security.jwt.secret-key}\") String secretKey, @Value(\"${security.jwt.expiration-time}\") long jwtExpiration ) { this.jwtExpiration = jwtExpiration; this.signingAlgorithm = Algorithm.HMAC256(secretKey); } public String extractEmail(String token) { JWTVerifier jwtVerifier = JWT.require(signingAlgorithm).build(); DecodedJWT jwt = jwtVerifier.verify(token); return jwt.getSubject(); } public boolean isTokenValid(String token, String email) { try { JWTVerifier verifier = JWT.require(signingAlgorithm) .withSubject(email) .build(); verifier.verify(token); } catch (JWTVerificationException exception) { return false; } return true; } public String buildToken(String email) { return JWT.create() .withSubject(email) .withIssuedAt(new Date()) .withExpiresAt(new Date(System.currentTimeMillis() + jwtExpiration)) .sign(signingAlgorithm); } } This code actually uses the Auth0‚Äôs JWT library . @Value(\"${security.jwt.secret-key}\") imports values from the application.properties file. This is mostly self-explanatory, we are setting user‚Äôs email as the subject and signing algorithm as HMAC256. One thing to keep in mind, jwtVerifier.verify(token); could throw verification error. At last AuthService.java:\npackage org.devabir.jwtexample.service; import org.devabir.jwtexample.model.UserDao; import org.devabir.jwtexample.model.UserRequestDto; import org.devabir.jwtexample.model.UserResponseDto; import org.devabir.jwtexample.repository.UserRepository; import org.springframework.beans.BeanUtils; import org.springframework.http.HttpStatus; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.stereotype.Service; import org.springframework.web.server.ResponseStatusException; @Service public class AuthService { private final UserService userService; private final UserRepository userRepository; private final PasswordEncoder passwordEncoder; private final AuthenticationManager authenticationManager; public AuthService(UserService userService, UserRepository userRepository, PasswordEncoder passwordEncoder, AuthenticationManager authenticationManager) { this.userService = userService; this.userRepository = userRepository; this.passwordEncoder = passwordEncoder; this.authenticationManager = authenticationManager; } public UserResponseDto register(UserRequestDto userRequestDto) { final String email = userRequestDto.getEmail(); if (this.userRepository.findById(email).isPresent()) throw new ResponseStatusException(HttpStatus.CONFLICT, \"Email \" + email + \" is already taken.\"); UserDao userDao = new UserDao(); BeanUtils.copyProperties(userRequestDto, userDao, \"password\"); userDao.setHashedPassword(this.passwordEncoder.encode(userRequestDto.getPassword())); userDao = this.userRepository.save(userDao); return this.userService.toDto(userDao); } public UserResponseDto login(UserRequestDto userRequestDto) { final String email = userRequestDto.getEmail(); UserDao userDao = userRepository. findById(email) .orElseThrow( () -\u003e new UsernameNotFoundException(\"User \" + email + \" not found.\") ); this.authenticationManager.authenticate( new UsernamePasswordAuthenticationToken( userRequestDto.getEmail(), userRequestDto.getPassword() ) ); return userService.toDto(userDao); } public UserResponseDto profile(String email) { UserDao userDao = userRepository .findById(email) .orElseThrow(() -\u003e new UsernameNotFoundException(\"User \" + email + \" not found.\")); return userService.toDto(userDao); } } We need to define 2 beans (PasswordEncoder and AuthenticationManager). We will define them in upcoming sections. this.authenticationManager.authenticate( new UsernamePasswordAuthenticationToken( userRequestDto.getEmail(), userRequestDto.getPassword() ) ); This will authenticate and save the user data into Spring‚Äôs context. Config Create a package called config.\nCreate AppConfig.java:\npackage org.devabir.jwtexample.config; import io.swagger.v3.oas.models.Components; import io.swagger.v3.oas.models.OpenAPI; import io.swagger.v3.oas.models.security.SecurityScheme; import org.devabir.jwtexample.model.UserDao; import org.devabir.jwtexample.repository.UserRepository; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import java.util.Collection; import java.util.List; import java.util.Optional; @Configuration public class AppConfig { private final UserRepository userRepository; public AppConfig(UserRepository userRepository) { this.userRepository = userRepository; } @Bean public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception { return authConfig.getAuthenticationManager(); } @Bean BCryptPasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider(); authProvider.setUserDetailsService(userDetailsService()); authProvider.setPasswordEncoder(passwordEncoder()); return authProvider; } @Bean UserDetailsService userDetailsService() { return new UserDetailsService() { @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { // NOTE: no username, we just use emails internally. final String email = username; Optional\u003cUserDao\u003e optionalUserDao = userRepository.findById(email); if (optionalUserDao.isEmpty()) { throw new UsernameNotFoundException(\"User \" + email + \" not found.\"); } UserDao user = optionalUserDao.get(); return new UserDetails() { @Override public Collection\u003c? extends GrantedAuthority\u003e getAuthorities() { return List.of(); } @Override public String getPassword() { return user.getHashedPassword(); } @Override public String getUsername() { return user.getEmail(); } }; } }; } @Bean public OpenAPI customOpenAPI() { return new OpenAPI() .components( new Components() .addSecuritySchemes( \"bearer-key\", new SecurityScheme() .type(SecurityScheme.Type.HTTP) .scheme(\"bearer\") .bearerFormat(\"JWT\") ) ); } } This is probably the most convoluted part of our current app. Here, our business logic interfaces with spring boot framework. We will go from top to bottom. The beans for AuthenticationManager and PasswordEncoder were required by the AuthService, we are defining it here. These will be injected into AuthService. Spring framework can work with many AuthenticationProvider, like: DaoAuthenticationProvider, LdapAuthenticationProvider. Also, we can implement complex rules like different authentication providers for different routes. We are defining a DaoAuthenticationProvider, which is very common (it uses a UserDetailsService to retrieve user details from the database and compare credentials). This UserDetailsService is very spring-specific way of defining users. We need to define loadUserByUsername(...) to retrieve the user from Database. We can also define some authorities for role-based access control purposes. Here username is just the user‚Äôs email. How we will define the UserDetails is up to us and spring will remember that, we can access that in a protected route. customOpenAPI() this is used to enhance the generated swagger docs, by adding authentication functionality. We will use this in demo later. Source . Create SecurityConfig.java:\npackage org.devabir.jwtexample.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import org.springframework.web.cors.CorsConfiguration; import org.springframework.web.cors.CorsConfigurationSource; import org.springframework.web.cors.UrlBasedCorsConfigurationSource; import java.util.List; @Configuration @EnableWebSecurity public class SecurityConfig { private final AuthenticationProvider authenticationProvider; private final JwtAuthFilter jwtAuthFilter; public SecurityConfig(AuthenticationProvider authenticationProvider, JwtAuthFilter jwtAuthFilter) { this.authenticationProvider = authenticationProvider; this.jwtAuthFilter = jwtAuthFilter; } @Bean public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception { httpSecurity.csrf(csrf -\u003e csrf.disable()); httpSecurity.headers(h -\u003e h.frameOptions(fo -\u003e fo.disable())); httpSecurity.authorizeHttpRequests( authorizeHttpRequests -\u003e authorizeHttpRequests .requestMatchers(\"/auth/profile\") .authenticated() .anyRequest() .permitAll() ); httpSecurity.sessionManagement(sessionManagement -\u003e sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS)); httpSecurity.authenticationProvider(authenticationProvider); httpSecurity.addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class); return httpSecurity.build(); } @Bean CorsConfigurationSource corsConfigurationSource() { CorsConfiguration corsConfiguration = new CorsConfiguration(); corsConfiguration.setAllowedOrigins(List.of(\"http:localhost:8080\")); corsConfiguration.setAllowedMethods(List.of(\"GET\", \"POST\")); corsConfiguration.setAllowedHeaders(List.of(\"Authorization\", \"Content-Type\")); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\"/**\", corsConfiguration); return source; } } This uses our defined AuthenticationProvider. CorsConfigurationSource is for setting up CORS configuration. These are set up on the server side. Read this for getting an idea . Each request at first goes through a number of filters. This is called SecurityFilterChain. We are configuring that: Disable CSRF because it‚Äôs a REST API and we aren‚Äôt working with session cookies. Disable X-Frame-Options, mainly for h2-console web UI. This might not be a good idea in production. /auth/profile will be a protected route. The rest are public. No session cookie, thus SessionCreationPolicy.STATELESS. httpSecurity.addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class); we are adding the JWT filter (to extract email from JWT token), before Spring‚Äôs Auth filter. Properties Finally, this is the last file.\nCreate application.properties within resources folder:\nspring.application.name=jwtexample server.error.include-stacktrace=never server.error.include-exception=false server.error.include-message=always spring.datasource.url=jdbc:h2:mem:userdb spring.datasource.driverClassName=org.h2.Driver spring.h2.console.enabled=true spring.jpa.database-platform=org.hibernate.dialect.H2Dialect spring.jpa.hibernate.ddl-auto=create-drop security.jwt.secret-key=3e0ba6026587dc722876146dd83b2222 # 1h in millisecond security.jwt.expiration-time=3600000 spring.output.ansi.enabled=ALWAYS The security.jwt.secret-key needs to be of 32 chars (HMAC256 requires 256-bit key (32 * 8 = 256 bits)). The spring.output.ansi.enabled=ALWAYS always gives a colored output :). server.error properties are used to conceal some confidential info. while presenting user with an error response. This is still not full proof and may leak info in validation errors, or sql errors. We are using the H2 database , which is an in-memory database. It is easy to deal with during development, but not ideal for production. There‚Äôs also an inbuilt web UI for H2 database. Demo Run the application in your IDE, or in terminal run ./gradlew bootRun (gradle), ./mvnw spring-boot:run (maven). Go to: http://localhost:8080/swagger-ui.html Explore the h2 database at: http://localhost:8080/h2-console. Make sure to enter proper database name (userdb). Do register (expand and press on Try it out), then login and at last access the profile. Use padlock sign to copy and paste the JWT access token, you get after logging in. Also, check for the validation errors. Below are some screenshots: If you have any issue following, here‚Äôs the source code repo .\nThanks a lot for reading\nStay safe,\nHave a nice day.\n","wordCount":"2274","inLanguage":"en","image":"https://dev-abir.github.io/cropped.jpeg","datePublished":"2024-05-29T17:15:44Z","dateModified":"2024-05-29T17:15:44Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://dev-abir.github.io/blogs/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc/"},"publisher":{"@type":"Organization","name":"Abir Ganguly | Portfolio","logo":{"@type":"ImageObject","url":"https://dev-abir.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dev-abir.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://dev-abir.github.io/cropped.jpeg alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dev-abir.github.io/experience title=Experience><span>Experience</span></a></li><li><a href=https://dev-abir.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://dev-abir.github.io/blogs/ title=Blogs><span>Blogs</span></a></li><li><a href=https://dev-abir.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://dev-abir.github.io/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><div style=position:absolute;top:0;left:0;width:100%;height:100%;z-index:-100;overflow:hidden id=particles-js></div><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dev-abir.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://dev-abir.github.io/blogs/>Blogs</a></div><h1 class="post-title entry-hint-parent">Spring boot JWT authentication (auth0) with Swagger docs (springdoc)</h1><div class=post-description>Why? This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives: To understand...</div><div class=post-meta><span title='2024-05-29 17:15:44 +0000 UTC'>29 May, 2024</span>&nbsp;¬∑&nbsp;11 min&nbsp;¬∑&nbsp;2274 words</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#why>Why?</a></li><li><a href=#how>How?</a><ul><li><a href=#initialize>Initialize</a></li><li><a href=#model>Model</a></li><li><a href=#jpa-repository>JPA Repository</a></li><li><a href=#controller>Controller</a></li><li><a href=#service>Service</a></li><li><a href=#config>Config</a></li><li><a href=#properties>Properties</a></li></ul></li><li><a href=#demo>Demo</a></li></ul></nav></div></details></div><div class=post-content><p><a href=https://dev.to/abir777/spring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc-1bp0 target=_blank rel="nofollow noopener noreferrer">üîó dev.to link</a></p><h2 id=why>Why?<a hidden class=anchor aria-hidden=true href=#why>#</a></h2><p>This is yet-another-spring-boot-jwt-tutorial. It has 2 main motives:</p><ul><li>To understand and document my understanding about spring security.</li><li>The existing articles mostly use <a href=https://github.com/jwtk/jjwt target=_blank rel="nofollow noopener noreferrer">jjwt</a>
which has a <strong><a href=https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt-impl/0.12.5 target=_blank rel="nofollow noopener noreferrer">vulnerable release</a>
(as of now)</strong>. Thus, I decided to use an <strong>alternative library</strong>, along with <strong><a href=https://springdoc.org/ target=_blank rel="nofollow noopener noreferrer">springdoc openapi 3 swagger</a>
docs</strong>.</li></ul><blockquote><p>Probably you could scavenge the internet, and use LLMs to put up such an implementation. I just created a <em>cookbook</em> kind of, you may use it as a guide.</p></blockquote><p>Let&rsquo;s start&mldr;</p><h2 id=how>How?<a hidden class=anchor aria-hidden=true href=#how>#</a></h2><p>This is not at all a beginner&rsquo;s guide, and I would assume the reader knows the <strong>basics of spring</strong>, IOC container, gradle, spring data JPA, how to build basic CRUD in spring boot.</p><p>As a starting point, you may follow <a href=https://spring.io/guides/gs/rest-service target=_blank rel="nofollow noopener noreferrer">this guide</a>
.</p><h3 id=initialize>Initialize<a hidden class=anchor aria-hidden=true href=#initialize>#</a></h3><p>This is a simple CRUD application with just <strong>3 routes</strong>: <code>/register</code>, <code>/login</code> and <code>/profile</code> (protected route). I hope this is pretty much self-explanatory. We will be using the <strong><a href=https://www.h2database.com/html/main.html target=_blank rel="nofollow noopener noreferrer">H2 database</a>
</strong>, which is an in-memory database. It is easy to deal with during development, <strong>but not ideal for production.</strong> There&rsquo;s also an inbuilt web UI for H2 database.</p><p>Go to <a href=https://start.spring.io/ target=_blank rel="nofollow noopener noreferrer">Spring boot initializr</a>
.</p><p>You will need the following dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-security&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-validation&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;com.auth0:java-jwt:4.4.0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.5.0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>compileOnly</span> <span class=s1>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>runtimeOnly</span> <span class=s1>&#39;com.h2database:h2&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>annotationProcessor</span> <span class=s1>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>testImplementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>testImplementation</span> <span class=s1>&#39;org.springframework.security:spring-security-test&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>testRuntimeOnly</span> <span class=s1>&#39;org.junit.platform:junit-platform-launcher&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><blockquote><p>The above alien language is groovy, which is used to configure Gradle build system (similar to xml in maven). The dependencies block is straightforward and pretty self-explanatory (one of the reasons why I prefer Gradle).</p></blockquote><p>Now, extract and import the gradle/maven project into your preferred editor. If any error occurs, make sure about <strong>spring and Java version.</strong></p><p>Two dependencies (<code>com.auth0:java-jwt</code> and <code>org.springdoc:springdoc-openapi-starter-webmvc-ui</code>) aren&rsquo;t available in spring starter.
Get them from <a href=https://mvnrepository.com/artifact/com.auth0/java-jwt target=_blank rel="nofollow noopener noreferrer">here</a>
and <a href=https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-starter-webmvc-ui target=_blank rel="nofollow noopener noreferrer">here</a>
.</p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/g4ljyrrkjuznnin49k7b.png alt="Spring initializr"></p><h3 id=model>Model<a hidden class=anchor aria-hidden=true href=#model>#</a></h3><p>We will first create our model, then controller, then service, in the meantime, we will also learn about the required things as we go along&mldr;</p><ol><li><p>Create a package called <code>controller</code>.</p></li><li><p>Create <code>UserDao.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.Column</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.Entity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.Id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.Table</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.Data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.NoArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.hibernate.annotations.CreationTimestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.hibernate.annotations.UpdateTimestamp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Date</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user_&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserDao</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hashed_password&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>hashedPassword</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@CreationTimestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;created_at&#34;</span><span class=p>,</span><span class=w> </span><span class=n>updatable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>createdAt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@UpdateTimestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;updated_at&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>updatedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This is for interacting with the database. Most db has <code>user</code> as reserved keyword, hence, we are calling it <code>user_</code>.</p><blockquote><p>Getters, setters, and constructors are all <strong>auto-generated by the annotations from lombok</strong>.
If you are new to this, you should spend some time and <a href=https://projectlombok.org/setup/ target=_blank rel="nofollow noopener noreferrer">setup lombok in your ide</a>
.</p></blockquote></li><li><p>Create <code>UserRequestDto.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.validation.constraints.Email</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.validation.constraints.NotBlank</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.Data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.NoArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserRequestDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@NotBlank</span><span class=p>(</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Email is mandatory.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// This email regex works. Trust me :)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Email</span><span class=p>(</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Please enter a valid email.&#34;</span><span class=p>,</span><span class=w> </span><span class=n>regexp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;^[a-zA-Z0-9_!#$%&amp;‚Äô*+/=?`{|}~^.-]+@[a-zA-Z0-9.-]+$&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@NotBlank</span><span class=p>(</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Password is mandatory.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>It also has <strong>validation logic</strong>. The email regex is sourced from some online searches, and it will work every time (trust me :)).</p></li><li><p>Create <code>UserResponseDto.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.Data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.NoArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Date</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserResponseDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>createdAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>updatedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Separate Response object, so that we <strong>don&rsquo;t accidentally leak out confidential attributes</strong> like password, also it includes generated fields like created and updated timestamp.</p></li><li><p>Create <code>TokenResponse.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.Data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.NoArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TokenResponse</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>accessToken</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserResponseDto</span><span class=w> </span><span class=n>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This class will be specifically used to respond on a <code>/login</code> request. We will not only send the user info, but also the <strong>JWT access token</strong>. In later sections, we will see how to set up the JWT part.</p></li></ol><p>This is all about the models, now let&rsquo;s set up the repository for interacting with the database.</p><h3 id=jpa-repository>JPA Repository<a hidden class=anchor aria-hidden=true href=#jpa-repository>#</a></h3><p>Create a package called <code>repository</code>, then inside that create <code>UserRepository.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserDao</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.jpa.repository.JpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>UserDao</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=controller>Controller<a hidden class=anchor aria-hidden=true href=#controller>#</a></h3><p>We have only one controller. Create a package <code>controller</code>, inside that a file <code>AuthController.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.controller</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.annotations.Operation</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.annotations.security.SecurityRequirement</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.validation.Valid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.TokenResponse</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserRequestDto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserResponseDto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.service.AuthService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.service.JwtService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.ResponseEntity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.Authentication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.context.SecurityContextHolder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/auth&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AuthController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AuthService</span><span class=w> </span><span class=n>authService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JwtService</span><span class=w> </span><span class=n>jwtService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AuthController</span><span class=p>(</span><span class=n>AuthService</span><span class=w> </span><span class=n>authService</span><span class=p>,</span><span class=w> </span><span class=n>JwtService</span><span class=w> </span><span class=n>jwtService</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>authService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jwtService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jwtService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/register&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>UserResponseDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>UserRequestDto</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CREATED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>authService</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>userRequestDto</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>TokenResponse</span><span class=o>&gt;</span><span class=w> </span><span class=nf>login</span><span class=p>(</span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>UserRequestDto</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserResponseDto</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authService</span><span class=p>.</span><span class=na>login</span><span class=p>(</span><span class=n>userRequestDto</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>accessToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jwtService</span><span class=p>.</span><span class=na>buildToken</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getEmail</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TokenResponse</span><span class=p>(</span><span class=n>accessToken</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>security</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=nd>@SecurityRequirement</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;bearer-key&#34;</span><span class=p>)})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/profile&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>UserResponseDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>profile</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Authentication</span><span class=w> </span><span class=n>authentication</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SecurityContextHolder</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getAuthentication</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserDetails</span><span class=w> </span><span class=n>userDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>UserDetails</span><span class=p>)</span><span class=w> </span><span class=n>authentication</span><span class=p>.</span><span class=na>getPrincipal</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userDetails</span><span class=p>.</span><span class=na>getUsername</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>authService</span><span class=p>.</span><span class=na>profile</span><span class=p>(</span><span class=n>email</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>This controller has 2 dependencies, <code>AuthService</code> and <code>JwtService</code>. We will eventually implement them.</li><li>This controller will give us a high-level overview of the API we are going to create.</li><li><code>@Valid</code> annotation will validate the Bean with the constraints like <code>@NotBlank</code>, defined earlier, and throw an appropriate error. Spring&rsquo;s default exception handler <a href=https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/ProblemDetailsExceptionHandler.java target=_blank rel="nofollow noopener noreferrer">ProblemDetailsExceptionHandler</a>
, will respond with an appropriate JSON.</li><li><code>@Operation(security = {@SecurityRequirement(name = "bearer-key")})</code> annotation is specific to springdoc, we will come to it at last. Just remember that it helps us to identify which routes require authentication in the generated docs.</li><li>In English, this roughly translates to: <em>&ldquo;If the user is authenticated, Spring should already have the authenticated user&rsquo;s data, which we are simply accessing.&rdquo;</em>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Authentication</span><span class=w> </span><span class=n>authentication</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SecurityContextHolder</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getAuthentication</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>UserDetails</span><span class=w> </span><span class=n>userDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>UserDetails</span><span class=p>)</span><span class=w> </span><span class=n>authentication</span><span class=p>.</span><span class=na>getPrincipal</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userDetails</span><span class=p>.</span><span class=na>getUsername</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div>Keep this part in mind, we will again use these when setting up security configs.</li></ul><h3 id=service>Service<a hidden class=anchor aria-hidden=true href=#service>#</a></h3><ol><li><p>Create a package called <code>service</code>.</p></li><li><p>Create <code>UserService.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserDao</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserResponseDto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.BeanUtils</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>UserService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserResponseDto</span><span class=w> </span><span class=nf>toDto</span><span class=p>(</span><span class=n>UserDao</span><span class=w> </span><span class=n>userDao</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserResponseDto</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserResponseDto</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BeanUtils</span><span class=p>.</span><span class=na>copyProperties</span><span class=p>(</span><span class=n>userDao</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>,</span><span class=w> </span><span class=s>&#34;hashedPassword&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>This file only <strong>converts the DAO to DTO</strong>, thus adhering to separation-of-concerns.</li><li>DTO and DAO have many common fields, thus we are copying the Bean properties. There are other methods like model-mapper, builder or constructor from lombok. This seemed short and simple enough.<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>copyProperties</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>source</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>target</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=p>...</span><span class=w> </span><span class=n>ignoreProperties</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>BeansException</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span></code></pre></div>This will work, <strong>even if you just omit the last parameter</strong>, I just included that to be explicit.</li></ul></li><li><p>Create <code>JwtService.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.auth0.jwt.JWT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.auth0.jwt.algorithms.Algorithm</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.auth0.jwt.exceptions.JWTVerificationException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.auth0.jwt.interfaces.DecodedJWT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.auth0.jwt.interfaces.JWTVerifier</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Date</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JwtService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>jwtExpiration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Algorithm</span><span class=w> </span><span class=n>signingAlgorithm</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>JwtService</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Value</span><span class=p>(</span><span class=s>&#34;${security.jwt.secret-key}&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>secretKey</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Value</span><span class=p>(</span><span class=s>&#34;${security.jwt.expiration-time}&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>jwtExpiration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jwtExpiration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jwtExpiration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>signingAlgorithm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Algorithm</span><span class=p>.</span><span class=na>HMAC256</span><span class=p>(</span><span class=n>secretKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>extractEmail</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>token</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JWTVerifier</span><span class=w> </span><span class=n>jwtVerifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JWT</span><span class=p>.</span><span class=na>require</span><span class=p>(</span><span class=n>signingAlgorithm</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DecodedJWT</span><span class=w> </span><span class=n>jwt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jwtVerifier</span><span class=p>.</span><span class=na>verify</span><span class=p>(</span><span class=n>token</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jwt</span><span class=p>.</span><span class=na>getSubject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isTokenValid</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>token</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>JWTVerifier</span><span class=w> </span><span class=n>verifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JWT</span><span class=p>.</span><span class=na>require</span><span class=p>(</span><span class=n>signingAlgorithm</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>withSubject</span><span class=p>(</span><span class=n>email</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>verifier</span><span class=p>.</span><span class=na>verify</span><span class=p>(</span><span class=n>token</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>JWTVerificationException</span><span class=w> </span><span class=n>exception</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>buildToken</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>JWT</span><span class=p>.</span><span class=na>create</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withSubject</span><span class=p>(</span><span class=n>email</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withIssuedAt</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>withExpiresAt</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>jwtExpiration</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>sign</span><span class=p>(</span><span class=n>signingAlgorithm</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>This code actually uses the <a href=https://github.com/auth0/java-jwt target=_blank rel="nofollow noopener noreferrer">Auth0&rsquo;s JWT library</a>
.</li><li><code>@Value("${security.jwt.secret-key}")</code> imports values from the <code>application.properties</code> file.</li><li>This is mostly self-explanatory, we are setting user&rsquo;s email as the subject and signing algorithm as <code>HMAC256</code>.</li><li>One thing to keep in mind, <code>jwtVerifier.verify(token);</code> could throw verification error.</li></ul></li><li><p>At last <code>AuthService.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserDao</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserRequestDto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserResponseDto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.repository.UserRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.BeanUtils</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.AuthenticationManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.UsernamePasswordAuthenticationToken</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UsernameNotFoundException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.crypto.password.PasswordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.server.ResponseStatusException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AuthService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AuthenticationManager</span><span class=w> </span><span class=n>authenticationManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AuthService</span><span class=p>(</span><span class=n>UserService</span><span class=w> </span><span class=n>userService</span><span class=p>,</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>,</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>,</span><span class=w> </span><span class=n>AuthenticationManager</span><span class=w> </span><span class=n>authenticationManager</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>userService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>userRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>passwordEncoder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>authenticationManager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authenticationManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserResponseDto</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=n>UserRequestDto</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getEmail</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>email</span><span class=p>).</span><span class=na>isPresent</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResponseStatusException</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Email &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; is already taken.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserDao</span><span class=w> </span><span class=n>userDao</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserDao</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BeanUtils</span><span class=p>.</span><span class=na>copyProperties</span><span class=p>(</span><span class=n>userRequestDto</span><span class=p>,</span><span class=w> </span><span class=n>userDao</span><span class=p>,</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userDao</span><span class=p>.</span><span class=na>setHashedPassword</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>passwordEncoder</span><span class=p>.</span><span class=na>encode</span><span class=p>(</span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getPassword</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userDao</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>userDao</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userService</span><span class=p>.</span><span class=na>toDto</span><span class=p>(</span><span class=n>userDao</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserResponseDto</span><span class=w> </span><span class=nf>login</span><span class=p>(</span><span class=n>UserRequestDto</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getEmail</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserDao</span><span class=w> </span><span class=n>userDao</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nf>findById</span><span class=p>(</span><span class=n>email</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsernameNotFoundException</span><span class=p>(</span><span class=s>&#34;User &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; not found.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>authenticationManager</span><span class=p>.</span><span class=na>authenticate</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>UsernamePasswordAuthenticationToken</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getEmail</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getPassword</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>toDto</span><span class=p>(</span><span class=n>userDao</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserResponseDto</span><span class=w> </span><span class=nf>profile</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserDao</span><span class=w> </span><span class=n>userDao</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>email</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsernameNotFoundException</span><span class=p>(</span><span class=s>&#34;User &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; not found.&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>toDto</span><span class=p>(</span><span class=n>userDao</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>We need to define 2 beans (<code>PasswordEncoder</code> and <code>AuthenticationManager</code>). We will define them in upcoming
sections.</li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>authenticationManager</span><span class=p>.</span><span class=na>authenticate</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>UsernamePasswordAuthenticationToken</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getEmail</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=n>userRequestDto</span><span class=p>.</span><span class=na>getPassword</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div>This will <strong>authenticate and save the user data</strong> into Spring&rsquo;s context.</li></ul></li></ol><h3 id=config>Config<a hidden class=anchor aria-hidden=true href=#config>#</a></h3><ol><li><p>Create a package called <code>config</code>.</p></li><li><p>Create <code>AppConfig.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.models.Components</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.models.OpenAPI</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.models.security.SecurityScheme</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.model.UserDao</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.devabir.jwtexample.repository.UserRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.AuthenticationManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.AuthenticationProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.dao.DaoAuthenticationProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UserDetailsService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UsernameNotFoundException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Collection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Optional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AppConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>AppConfig</span><span class=p>(</span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>userRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>AuthenticationManager</span><span class=w> </span><span class=nf>authenticationManager</span><span class=p>(</span><span class=n>AuthenticationConfiguration</span><span class=w> </span><span class=n>authConfig</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>authConfig</span><span class=p>.</span><span class=na>getAuthenticationManager</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>BCryptPasswordEncoder</span><span class=w> </span><span class=nf>passwordEncoder</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BCryptPasswordEncoder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>AuthenticationProvider</span><span class=w> </span><span class=nf>authenticationProvider</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DaoAuthenticationProvider</span><span class=w> </span><span class=n>authProvider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DaoAuthenticationProvider</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>authProvider</span><span class=p>.</span><span class=na>setUserDetailsService</span><span class=p>(</span><span class=n>userDetailsService</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>authProvider</span><span class=p>.</span><span class=na>setPasswordEncoder</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>authProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>UserDetailsService</span><span class=w> </span><span class=nf>userDetailsService</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserDetailsService</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=n>UserDetails</span><span class=w> </span><span class=nf>loadUserByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>UsernameNotFoundException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// NOTE: no username, we just use emails internally.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>UserDao</span><span class=o>&gt;</span><span class=w> </span><span class=n>optionalUserDao</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>email</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>optionalUserDao</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsernameNotFoundException</span><span class=p>(</span><span class=s>&#34;User &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; not found.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>UserDao</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>optionalUserDao</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserDetails</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>public</span><span class=w> </span><span class=n>Collection</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>GrantedAuthority</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAuthorities</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getPassword</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getHashedPassword</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getUsername</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>return</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getEmail</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>OpenAPI</span><span class=w> </span><span class=nf>customOpenAPI</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OpenAPI</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>components</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>new</span><span class=w> </span><span class=n>Components</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=p>.</span><span class=na>addSecuritySchemes</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                        </span><span class=s>&#34;bearer-key&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                        </span><span class=k>new</span><span class=w> </span><span class=n>SecurityScheme</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                </span><span class=p>.</span><span class=na>type</span><span class=p>(</span><span class=n>SecurityScheme</span><span class=p>.</span><span class=na>Type</span><span class=p>.</span><span class=na>HTTP</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                </span><span class=p>.</span><span class=na>scheme</span><span class=p>(</span><span class=s>&#34;bearer&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                </span><span class=p>.</span><span class=na>bearerFormat</span><span class=p>(</span><span class=s>&#34;JWT&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>This is probably the most convoluted part of our current app. Here, our business logic interfaces with spring boot framework. We will go from top to bottom.</li><li>The beans for <code>AuthenticationManager</code> and <code>PasswordEncoder</code> were required by the <code>AuthService</code>, we are defining it here. These will be injected into <code>AuthService</code>.</li><li>Spring framework can work with many <code>AuthenticationProvider</code>, like: <code>DaoAuthenticationProvider</code>, <code>LdapAuthenticationProvider</code>. Also, we can implement <strong>complex rules like different authentication providers for different routes.</strong></li><li>We are defining a <code>DaoAuthenticationProvider</code>, which is very common (it uses a <code>UserDetailsService</code> to retrieve user details from the database and compare credentials).</li><li>This <code>UserDetailsService</code> is very spring-specific way of defining users. We need to define <code>loadUserByUsername(...)</code> <strong>to retrieve the user from Database</strong>. We can also define some authorities for role-based access control purposes. Here username is just the user&rsquo;s email.</li><li>How we will define <strong>the <code>UserDetails</code> is up to us</strong> and spring will remember that, we can access that in a protected route.</li><li><code>customOpenAPI()</code> this is used to enhance the generated swagger docs, by <strong>adding authentication functionality</strong>. We will use this in demo later. <a href=https://springdoc.org/#how-do-i-add-authorization-header-in-requests target=_blank rel="nofollow noopener noreferrer">Source</a>
.</li></ul></li><li><p>Create <code>SecurityConfig.java</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.devabir.jwtexample.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.authentication.AuthenticationProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.http.SessionCreationPolicy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.cors.CorsConfiguration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.cors.CorsConfigurationSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.cors.UrlBasedCorsConfigurationSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AuthenticationProvider</span><span class=w> </span><span class=n>authenticationProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JwtAuthFilter</span><span class=w> </span><span class=n>jwtAuthFilter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SecurityConfig</span><span class=p>(</span><span class=n>AuthenticationProvider</span><span class=w> </span><span class=n>authenticationProvider</span><span class=p>,</span><span class=w> </span><span class=n>JwtAuthFilter</span><span class=w> </span><span class=n>jwtAuthFilter</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>authenticationProvider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>authenticationProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jwtAuthFilter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jwtAuthFilter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>securityFilterChain</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>httpSecurity</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>csrf</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>csrf</span><span class=p>.</span><span class=na>disable</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>headers</span><span class=p>(</span><span class=n>h</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>h</span><span class=p>.</span><span class=na>frameOptions</span><span class=p>(</span><span class=n>fo</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>fo</span><span class=p>.</span><span class=na>disable</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>authorizeHttpRequests</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>authorizeHttpRequests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/auth/profile&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>sessionManagement</span><span class=p>(</span><span class=n>sessionManagement</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>sessionManagement</span><span class=p>.</span><span class=na>sessionCreationPolicy</span><span class=p>(</span><span class=n>SessionCreationPolicy</span><span class=p>.</span><span class=na>STATELESS</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>authenticationProvider</span><span class=p>(</span><span class=n>authenticationProvider</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>addFilterBefore</span><span class=p>(</span><span class=n>jwtAuthFilter</span><span class=p>,</span><span class=w> </span><span class=n>UsernamePasswordAuthenticationFilter</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>httpSecurity</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CorsConfigurationSource</span><span class=w> </span><span class=nf>corsConfigurationSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CorsConfiguration</span><span class=w> </span><span class=n>corsConfiguration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CorsConfiguration</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>corsConfiguration</span><span class=p>.</span><span class=na>setAllowedOrigins</span><span class=p>(</span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;http:localhost:8080&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>corsConfiguration</span><span class=p>.</span><span class=na>setAllowedMethods</span><span class=p>(</span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;POST&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>corsConfiguration</span><span class=p>.</span><span class=na>setAllowedHeaders</span><span class=p>(</span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Content-Type&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UrlBasedCorsConfigurationSource</span><span class=w> </span><span class=n>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UrlBasedCorsConfigurationSource</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>source</span><span class=p>.</span><span class=na>registerCorsConfiguration</span><span class=p>(</span><span class=s>&#34;/**&#34;</span><span class=p>,</span><span class=w> </span><span class=n>corsConfiguration</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>source</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>This uses our defined <code>AuthenticationProvider</code>.</li><li><code>CorsConfigurationSource</code> is for setting up <strong>CORS configuration.</strong> These are set up on the server side. <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS target=_blank rel="nofollow noopener noreferrer">Read this for getting an idea</a>
.</li><li><strong>Each request at first goes through a number of filters. This is called <code>SecurityFilterChain</code>.</strong> We are configuring that:<ul><li><strong>Disable CSRF</strong> because it&rsquo;s a REST API and we aren&rsquo;t working with session cookies.</li><li><strong>Disable X-Frame-Options</strong>, mainly for h2-console web UI. <strong>This might not be a good idea in production.</strong></li><li><strong><code>/auth/profile</code> will be a protected route.</strong> The rest are public.</li><li><strong>No session cookie</strong>, thus <code>SessionCreationPolicy.STATELESS</code>.</li><li><code>httpSecurity.addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);</code> <strong>we are adding the JWT filter (to extract email from JWT token), before Spring&rsquo;s Auth filter.</strong></li></ul></li></ul></li></ol><h3 id=properties>Properties<a hidden class=anchor aria-hidden=true href=#properties>#</a></h3><p>Finally, this is the last file.</p><p>Create <code>application.properties</code> within resources folder:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>spring.application.name</span><span class=o>=</span><span class=s>jwtexample</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>server.error.include-stacktrace</span><span class=o>=</span><span class=s>never</span>
</span></span><span class=line><span class=cl><span class=na>server.error.include-exception</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl><span class=na>server.error.include-message</span><span class=o>=</span><span class=s>always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.url</span><span class=o>=</span><span class=s>jdbc:h2:mem:userdb</span>
</span></span><span class=line><span class=cl><span class=na>spring.datasource.driverClassName</span><span class=o>=</span><span class=s>org.h2.Driver</span>
</span></span><span class=line><span class=cl><span class=na>spring.h2.console.enabled</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.database-platform</span><span class=o>=</span><span class=s>org.hibernate.dialect.H2Dialect</span>
</span></span><span class=line><span class=cl><span class=na>spring.jpa.hibernate.ddl-auto</span><span class=o>=</span><span class=s>create-drop</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>security.jwt.secret-key</span><span class=o>=</span><span class=s>3e0ba6026587dc722876146dd83b2222</span>
</span></span><span class=line><span class=cl><span class=c1># 1h in millisecond</span>
</span></span><span class=line><span class=cl><span class=na>security.jwt.expiration-time</span><span class=o>=</span><span class=s>3600000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>spring.output.ansi.enabled</span><span class=o>=</span><span class=s>ALWAYS</span>
</span></span></code></pre></div><ul><li>The <code>security.jwt.secret-key</code> needs to be of <strong>32 chars</strong> (<code>HMAC256</code> requires 256-bit key (32 * 8 = 256 bits)).</li><li>The <code>spring.output.ansi.enabled=ALWAYS</code> always gives a colored output :).</li><li><code>server.error</code> properties are used to conceal some confidential info. while presenting user with an error response. <strong>This is still not full proof and may leak info in validation errors, or sql errors.</strong></li><li>We are using the <a href=https://www.h2database.com/html/main.html target=_blank rel="nofollow noopener noreferrer">H2 database</a>
, which is an in-memory database. It is easy to deal with during development, <strong>but not ideal for production.</strong> There&rsquo;s also an inbuilt web UI for H2 database.</li></ul><h2 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h2><ul><li>Run the application in your IDE, or in terminal run <code>./gradlew bootRun</code> (gradle), <code>./mvnw spring-boot:run</code> (maven).</li><li>Go to: http://localhost:8080/swagger-ui.html</li><li>Explore the h2 database at: http://localhost:8080/h2-console. <strong>Make sure to enter proper database name (<code>userdb</code>).</strong></li><li>Do register <strong>(expand and press on Try it out)</strong>, then login and at last access the profile. Use padlock sign to copy and paste the JWT access token, you get after logging in.</li><li>Also, check for the validation errors.</li><li>Below are some screenshots:</li></ul><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4daaat0rucab7anjb3hf.png alt=Swagger></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qavipbwdca8gyo5hmg1o.png alt=Register></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/stu1ikdd1jrir1yvkbak.png alt="Register response"></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/a55ltog070sc43r9x8nn.png alt="Login response"></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hz60cnbansnhpgn2irjy.png alt="Set access token"></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/93ap0er29gloiw8ettd6.png alt=Profile></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xmw9kbakgna51dqcyoik.png alt="H2 login"></p><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b6sm9fmacv5yh043f3kq.png alt="H2 sql query"></p><p>If you have any issue following, here&rsquo;s the <a href=https://github.com/dev-abir/jwtexample target=_blank rel="nofollow noopener noreferrer">source code repo</a>
.</p><p>Thanks a lot for reading</p><p>Stay safe,</p><p>Have a nice day.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dev-abir.github.io/tags/springboot/>Springboot</a></li><li><a href=https://dev-abir.github.io/tags/springsecurity/>Springsecurity</a></li><li><a href=https://dev-abir.github.io/tags/webdev/>Webdev</a></li><li><a href=https://dev-abir.github.io/tags/java/>Java</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on x" href="https://x.com/intent/tweet/?text=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29&amp;url=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f&amp;hashtags=springboot%2cspringsecurity%2cwebdev%2cjava"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f&amp;title=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29&amp;summary=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29&amp;source=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f&title=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on whatsapp" href="https://api.whatsapp.com/send?text=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29%20-%20https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on telegram" href="https://telegram.me/share/url?text=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29&amp;url=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Spring boot JWT authentication (auth0) with Swagger docs (springdoc) on ycombinator" href="https://news.ycombinator.com/submitlink?t=Spring%20boot%20JWT%20authentication%20%28auth0%29%20with%20Swagger%20docs%20%28springdoc%29&u=https%3a%2f%2fdev-abir.github.io%2fblogs%2fspring-boot-jwt-authentication-auth0-with-swagger-docs-springdoc%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://dev-abir.github.io/>Abir Ganguly | Portfolio</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),pJSDom[0]&&(pJSDom[0].pJS.particles.color.value="#000000",pJSDom[0].pJS.particles.line_linked.color="#000000",pJSDom[0].pJS.fn.particlesRefresh())):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),pJSDom[0]&&(pJSDom[0].pJS.particles.color.value="#ffffff",pJSDom[0].pJS.particles.line_linked.color="#ffffff",pJSDom[0].pJS.fn.particlesRefresh()))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>